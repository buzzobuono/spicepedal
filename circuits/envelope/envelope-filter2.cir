* Envelope Filter ispirato Bassballs (solo sezione env + filtro modulato)
* Alimentazioni ±9V
VCC 10 0 DC 9
VEE 11 0 DC -9

* --- Ingresso ---
C_in 1 2 0.1u
R_in 2 0 47k

* --- Buffer ingresso (OpAmp unity) ---
O1 3 2 3 10 11 TL072 Rout=75 Imax=0.020 Gain=1000 Sr=5

* --- Envelope follower ---
D1 3 4 D_LOW Is=1e-15 N=1 Vt=0.026 Cj0=2e-12 Vj=0.2 Mj=0.5
C1 4 0 1u
R1 4 0 47k
* Stabilizza nodo alto impedenza
R4b 4 0 1Meg

* --- Filtro passa-banda controllato dall'envelope ---
* Frequenza di taglio modulata da V(4)
* Stadio passa-banda attivo semplice
R2 3 5 10k
C2 5 0 100e-9
O2 6 5 6 10 11 TL072 Rout=75 Imax=0.020 Gain=1000 Sr=5

* Modula la resistenza efficace tramite V(4) (scaling)
* Qui puoi implementare un controllo lineare sulla frequenza
* R_modula = 10k + k*V(4) (concetto, nel simulatore si può fare via transconductance o voltage-controlled resistor)

.input 1
.output 6
.probe envelope_filter.csv V(1) V(2) V(3) V(4) V(5) V(6)
.warmup 60